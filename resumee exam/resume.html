<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Resume Builder - Form</title>
<style>
  :root{--accent:#667eea;--muted:#6b7280}
  body{font-family:Inter,Segoe UI,Arial;margin:0;background:#3f73da;padding:28px}
  .wrap{max-width:1000px;margin:0 auto;background:white;border-radius:12px;padding:26px;box-shadow:0 12px 36px rgba(20,20,40,.06)}
  h2{margin:0 0 8px}
  .grid{display:grid;grid-template-columns:260px 1fr;gap:16px}
  label{display:block;font-weight:700;margin-bottom:6px}
  input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-family:inherit}
  textarea{min-height:100px;resize:vertical}
  .full{grid-column:1/ -1}
  .row{display:flex;gap:12px}
  button{background:var(--accent);color:white;padding:12px 18px;border:0;border-radius:10px;font-weight:700;cursor:pointer}
  .btn-light{background:#eef2ff;color:var(--accent);border:2px solid var(--accent)}
  .actions{display:flex;gap:12px;justify-content:flex-end;margin-top:16px}
  small{color:var(--muted)}
  @media(max-width:880px){.grid{grid-template-columns:1fr}.actions{flex-direction:column;align-items:stretch}}

  /* Avatar area */
  .profile-box{display:flex;flex-direction:column;align-items:center;gap:12px;padding:12px;border-radius:10px;border:1px dashed #e6e9ef}
  .avatar{
    width:140px;height:140px;border-radius:999px;overflow:hidden;display:inline-block;
    background:linear-gradient(180deg,#f6f7fb,#fff);box-shadow:0 6px 18px rgba(20,20,40,.04);
    display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--muted);font-size:20px;
    cursor:pointer;border:4px solid #fff;
  }
  .avatar img{width:100%;height:100%;object-fit:cover;display:block}
  .avatar-placeholder{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:12px;text-align:center}
  .file-row{display:flex;gap:8px;align-items:center}
  .remove-photo{background:#fff;border:1px solid #e6e9ef;color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}
  .hint{font-size:13px;color:var(--muted);text-align:center}
  input[type=file]{display:none}
</style>
</head>
<body>
  <div class="wrap">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2>Build Your Resume</h2>
      <div style="color:var(--muted)">Data stays in your browser (localStorage)</div>
    </div>

    <form id="resumeForm" onsubmit="return false;">
      <div class="grid">

        <!-- Profile column -->
        <div>
          <label style="margin-bottom:10px">Profile Photo</label>
          <div class="profile-box">
            <label id="avatarLabel" class="avatar" title="Click to upload photo" for="photoInput" tabindex="0">
              <!-- Image or placeholder will go here -->
              <div class="avatar-placeholder" id="avatarPlaceholder">
                <div style="font-size:28px">+</div>
                <div style="font-size:13px;color:var(--muted);margin-top:6px">Add photo</div>
              </div>
              <img id="avatarImg" alt="Profile photo" style="display:none">
            </label>

            <div class="file-row">
              <input id="photoInput" type="file" accept="image/*" aria-label="Upload profile photo">
              <button type="button" class="remove-photo" id="removePhotoBtn" title="Remove photo">Remove</button>
            </div>
            <div class="hint">Click avatar to choose image. Max recommended size 2MB.</div>
          </div>
        </div>

        <!-- Form fields -->
        <div>
          <div style="display:flex;gap:12px;margin-bottom:12px">
            <div style="flex:1">
              <label for="name">Full Name</label>
              <input id="name" placeholder="Mariana Anderson">
            </div>
            <div style="flex:1">
              <label for="title">Professional Title</label>
              <input id="title" placeholder="Marketing Manager">
            </div>
          </div>

          <div style="display:flex;gap:12px;margin-bottom:12px">
            <div style="flex:1">
              <label for="phone">Phone</label>
              <input id="phone" placeholder="123-456-7890">
            </div>
            <div style="flex:1">
              <label for="email">Email</label>
              <input id="email" placeholder="hello@example.com">
            </div>
          </div>

          <div style="display:flex;gap:12px;margin-bottom:12px">
            <div style="flex:1">
              <label for="website">Website</label>
              <input id="website" placeholder="www.example.com">
            </div>
            <div style="flex:1">
              <label for="address">Address</label>
              <input id="address" placeholder="121 Street, NY">
            </div>
          </div>

          <div style="margin-bottom:12px">
            <label for="summary">Professional Summary</label>
            <textarea id="summary" placeholder="Write a brief professional summary..."></textarea>
          </div>

          <div style="margin-bottom:12px">
            <label for="expertise">Expertise / Skills (one per line)</label>
            <textarea id="expertise" placeholder="Visual Design&#10;Wireframes&#10;Storyboards"></textarea>
          </div>
        </div>

        <!-- The rest of the fields span full width -->
        <div class="full">
          <label>Work Experience</label>
          <div id="experienceContainer"></div>
          <div style="margin-top:10px" class="row">
            <button onclick="addExperience()" type="button">+ Add Experience</button>
            <button onclick="clearExperience()" type="button" class="btn-light">Clear Experiences</button>
          </div>
          <small>Each item: duration, position, company, description.</small>
        </div>

        <div class="full">
          <label>Education</label>
          <div id="educationContainer"></div>
          <div style="margin-top:10px" class="row">
            <button onclick="addEducation()" type="button">+ Add Education</button>
            <button onclick="clearEducation()" type="button" class="btn-light">Clear Education</button>
          </div>
        </div>

        <div class="full">
          <label>Languages</label>
          <div id="languageContainer"></div>
          <div style="margin-top:10px" class="row">
            <button onclick="addLanguage()" type="button">+ Add Language</button>
            <button onclick="clearLanguages()" type="button" class="btn-light">Clear Languages</button>
          </div>
        </div>

        <div class="full">
          <label>References</label>
          <div id="referenceContainer"></div>
          <div style="margin-top:10px" class="row">
            <button onclick="addReference()" type="button">+ Add Reference</button>
            <button onclick="clearReferences()" type="button" class="btn-light">Clear References</button>
          </div>
        </div>

      </div>

      <div class="actions">
        <a href="index.html" class="btn-light" style="text-decoration:none;display:inline-flex;align-items:center;gap:8px;padding:10px 14px">← Home</a>
        <button onclick="saveAndPreview()">Save & Preview →</button>
      </div>
    </form>
  </div>

<script>
  // Small helpers for dynamic blocks
  let expId=0, eduId=0, langId=0, refId=0;

  function makeDiv(html){ const d=document.createElement('div'); d.innerHTML=html; return d.firstElementChild; }

  function addExperience(data){
    expId++;
    const html = `<div class="item" id="exp-${expId}" style="border:1px dashed #e6e9ef;padding:10px;margin-bottom:10px;border-radius:8px">
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <input placeholder="Duration (e.g. 2019 - 2022)" class="exp-duration" style="flex:1">
        <input placeholder="Position" class="exp-position" style="flex:1">
      </div>
      <input placeholder="Company" class="exp-company" style="width:100%;margin-bottom:8px">
      <textarea placeholder="Description" class="exp-description" style="width:100%"></textarea>
      <div style="text-align:right;margin-top:8px"><button type="button" onclick="this.closest('.item').remove()">Remove</button></div>
    </div>`;
    const node = makeDiv(html);
    if (data){ node.querySelector('.exp-duration').value = data.duration || ''; node.querySelector('.exp-position').value = data.position || ''; node.querySelector('.exp-company').value = data.company || ''; node.querySelector('.exp-description').value = data.description || ''; }
    document.getElementById('experienceContainer').appendChild(node);
  }

  function addEducation(data){
    eduId++;
    const html = `<div class="item" id="edu-${eduId}" style="border:1px dashed #e6e9ef;padding:10px;margin-bottom:10px;border-radius:8px">
      <div style="display:flex;gap:8px">
        <input placeholder="Year" class="edu-year" style="width:110px">
        <input placeholder="Degree" class="edu-degree" style="flex:1">
      </div>
      <input placeholder="Institution" class="edu-school" style="width:100%;margin-top:8px">
      <div style="text-align:right;margin-top:8px"><button type="button" onclick="this.closest('.item').remove()">Remove</button></div>
    </div>`;
    const node = makeDiv(html);
    if (data){ node.querySelector('.edu-year').value=data.year||''; node.querySelector('.edu-degree').value=data.degree||''; node.querySelector('.edu-school').value=data.school||''; }
    document.getElementById('educationContainer').appendChild(node);
  }

  function addLanguage(data){
    langId++;
    const html = `<div class="item" id="lang-${langId}" style="border:1px dashed #e6e9ef;padding:10px;margin-bottom:10px;border-radius:8px">
      <div style="display:flex;gap:8px">
        <input placeholder="Language" class="lang-name" style="flex:1">
        <input placeholder="Level (e.g. Native)" class="lang-level" style="width:140px">
      </div>
      <div style="text-align:right;margin-top:8px"><button type="button" onclick="this.closest('.item').remove()">Remove</button></div>
    </div>`;
    const node = makeDiv(html);
    if (data){ node.querySelector('.lang-name').value=data.name||''; node.querySelector('.lang-level').value=data.level||''; }
    document.getElementById('languageContainer').appendChild(node);
  }

  function addReference(data){
    refId++;
    const html=`<div class="item" id="ref-${refId}" style="border:1px dashed #e6e9ef;padding:10px;margin-bottom:10px;border-radius:8px">
      <input placeholder="Name" class="ref-name" style="width:100%;margin-bottom:8px">
      <input placeholder="Position / Company" class="ref-position" style="width:100%;margin-bottom:8px">
      <input placeholder="Contact" class="ref-contact" style="width:100%">
      <div style="text-align:right;margin-top:8px"><button type="button" onclick="this.closest('.item').remove()">Remove</button></div>
    </div>`;
    const node = makeDiv(html);
    if (data){ node.querySelector('.ref-name').value=data.name||''; node.querySelector('.ref-position').value=data.position||''; node.querySelector('.ref-contact').value=data.contact||''; }
    document.getElementById('referenceContainer').appendChild(node);
  }

  // Clear helpers
  function clearExperience(){ document.getElementById('experienceContainer').innerHTML=''; }
  function clearEducation(){ document.getElementById('educationContainer').innerHTML=''; }
  function clearLanguages(){ document.getElementById('languageContainer').innerHTML=''; }
  function clearReferences(){ document.getElementById('referenceContainer').innerHTML=''; }

  // ---------- Profile photo logic ----------
  const photoInput = document.getElementById('photoInput');
  const avatarImg = document.getElementById('avatarImg');
  const avatarPlaceholder = document.getElementById('avatarPlaceholder');
  const removePhotoBtn = document.getElementById('removePhotoBtn');
  const avatarLabel = document.getElementById('avatarLabel');

  function setAvatarFromDataUrl(dataUrl){
    if (!dataUrl){
      avatarImg.style.display = 'none';
      avatarImg.src = '';
      avatarPlaceholder.style.display = 'flex';
      return;
    }
    avatarImg.src = dataUrl;
    avatarImg.onload = () => {
      avatarImg.style.display = 'block';
      avatarPlaceholder.style.display = 'none';
    };
  }

  // When file selected
  photoInput.addEventListener('change', async (e) => {
    const f = e.target.files && e.target.files[0];
    if (!f) return;
    // optional: limit size (warn + ignore too large)
    const maxMB = 5;
    if (f.size > maxMB * 1024 * 1024){
      alert('Image is too large. Please choose an image under ' + maxMB + 'MB.');
      photoInput.value = '';
      return;
    }
    const reader = new FileReader();
    reader.onload = function(ev){
      const dataUrl = ev.target.result;
      setAvatarFromDataUrl(dataUrl);
      // immediately persist photo to stored resumeData (so preview + save keep it)
      const raw = localStorage.getItem('resumeData');
      let d = raw ? JSON.parse(raw) : {};
      d.photo = dataUrl;
      localStorage.setItem('resumeData', JSON.stringify(d));
    };
    reader.readAsDataURL(f);
  });

  // Remove photo
  removePhotoBtn.addEventListener('click', () => {
    photoInput.value = '';
    setAvatarFromDataUrl('');
    const raw = localStorage.getItem('resumeData');
    if (!raw) return;
    try {
      const d = JSON.parse(raw);
      delete d.photo;
      localStorage.setItem('resumeData', JSON.stringify(d));
    } catch(e){}
  });

  // keyboard accessibility: Enter / Space on label opens file dialog
  avatarLabel.addEventListener('keydown', (ev) => {
    if (ev.key === 'Enter' || ev.key === ' ') {
      ev.preventDefault();
      photoInput.click();
    }
  });

  // ---------- Save form into localStorage and open preview ----------
  function saveAndPreview(){
    const data = {
      name: document.getElementById('name').value.trim(),
      title: document.getElementById('title').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      email: document.getElementById('email').value.trim(),
      website: document.getElementById('website').value.trim(),
      address: document.getElementById('address').value.trim(),
      summary: document.getElementById('summary').value.trim(),
      expertise: document.getElementById('expertise').value.trim().split(/\r?\n/).map(s=>s.trim()).filter(Boolean),
      experiences: [],
      educations: [],
      languages: [],
      references: [],
      photo: null
    };

    // include current preview photo if present
    if (avatarImg.src && avatarImg.style.display !== 'none') data.photo = avatarImg.src;

    document.querySelectorAll('#experienceContainer .item').forEach(it=>{
      data.experiences.push({
        duration: it.querySelector('.exp-duration')?.value.trim()||'',
        position: it.querySelector('.exp-position')?.value.trim()||'',
        company: it.querySelector('.exp-company')?.value.trim()||'',
        description: it.querySelector('.exp-description')?.value.trim()||''
      });
    });
    document.querySelectorAll('#educationContainer .item').forEach(it=>{
      data.educations.push({
        year: it.querySelector('.edu-year')?.value.trim()||'',
        degree: it.querySelector('.edu-degree')?.value.trim()||'',
        school: it.querySelector('.edu-school')?.value.trim()||''
      });
    });
    document.querySelectorAll('#languageContainer .item').forEach(it=>{
      data.languages.push({
        name: it.querySelector('.lang-name')?.value.trim()||'',
        level: it.querySelector('.lang-level')?.value.trim()||''
      });
    });
    document.querySelectorAll('#referenceContainer .item').forEach(it=>{
      data.references.push({
        name: it.querySelector('.ref-name')?.value.trim()||'',
        position: it.querySelector('.ref-position')?.value.trim()||'',
        contact: it.querySelector('.ref-contact')?.value.trim()||''
      });
    });

    // Save to localStorage
    localStorage.setItem('resumeData', JSON.stringify(data));

    // Open preview page
    window.location.href = 'preview.html';
  }

  // On load: populate fields from stored data (if available)
  (function initFromStorage(){
    const raw = localStorage.getItem('resumeData');
    if (!raw) {
      // add 1 example blocks to guide
      addExperience();
      addEducation();
      addLanguage();
      addReference();
      setAvatarFromDataUrl('');
      return;
    }
    try {
      const d = JSON.parse(raw);
      document.getElementById('name').value = d.name || '';
      document.getElementById('title').value = d.title || '';
      document.getElementById('phone').value = d.phone || '';
      document.getElementById('email').value = d.email || '';
      document.getElementById('website').value = d.website || '';
      document.getElementById('address').value = d.address || '';
      document.getElementById('summary').value = d.summary || '';
      document.getElementById('expertise').value = (d.expertise || []).join('\n');

      (d.experiences || []).forEach(e => addExperience(e));
      (d.educations || []).forEach(e => addEducation(e));
      (d.languages || []).forEach(l => addLanguage(l));
      (d.references || []).forEach(r => addReference(r));

      // set avatar if present (d.photo should be a data URL)
      if (d.photo) setAvatarFromDataUrl(d.photo);
      else setAvatarFromDataUrl('');
    } catch(e){ console.warn('resumeData parse error', e); addExperience(); addEducation(); addLanguage(); addReference(); setAvatarFromDataUrl(''); }
  })();
</script>
</body>
</html>
